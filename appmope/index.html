<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Appmope</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
	</head>
	<body class="homepage" onload="onBodyLoad()">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header">

					<!-- Inner -->
						<div class="inner">
							<header>
								<h1 color="#df7366"><a href="index.html" id="logo">Appmope</a></h1>
								<hr />
								<p>Bienvenido a la era del periodismo digital</p>
							</header>
							<footer>
								<a href="#banner" class="button circled scrolly">Noticia!!</a>
								<a href="#reciente" class="button circled scrolly">Reciente</a>
								<a href="#features" class="button circled scrolly">Chat</a>
								<a href="left-sidebar.html" class="button circled scrolly">GrabaMope</a>
							</footer>
						</div>

					<!-- Nav  jgf-->
						

				</div>

			<!-- Banner -->
				<section id="banner">
					<header>
						<h2>Publica tu noticia aqu√≠</h2>
						<p id="estado">
							Cargando...
						</p>
							<input id="titulo" type="text" style="width:50%" size="50%" placeholder="Titulo de la noticia" ><br><br>
							<textarea id="contenidoNoticia" style="width:50% ; height: 100px" placeholder="Publica el contenido de la noticia!"></textarea><br>
							<input type="submit" value="Publicar!" onClick="enviarNoticia()">
						
						
					</header>
				</section>

			

			<!-- Main -->
				<div class="wrapper style2">

					<article id="main" class="container special">
						<a href="#" class="image featured"><img src="images/pic06.jpg" alt="" /></a>
						<header>
							<h2 id="reciente"><a href="#">Noticias Recientes</a></h2>
							<p>
								Estas son las noticias recientes de sus colegas.
							</p>
						</header>
						<p id="noticiamensaje">
							
						</p>
						<p id="noticiabd1">
							
						</p>
						<p id="noticiabd2">
							
						</p>
						<p id="noticiabd3">
							
						</p>
						<p id="noticiabd4">
							
						</p>
						<p id="noticiabd5">
							
						</p>
						<footer>
						
						</footer>
					</article>
					<section class="carousel">
					<div class="reel">

						<article>
							<a href="#" id="imagen1" class="image featured"></a>
							<header>
								<h3 id="noticiabd1titulo"></h3>
							</header>
							<p id="noticiabd1contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen2" class="image featured"><img src="images/pic02.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd2titulo"><a href="#"></a></h3>
							</header>
							<p id="noticiabd2contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen3" class="image featured"><img src="images/pic03.jpg" alt="" /></a>
							<header>
								<a href="#"><h3 id="noticiabd3titulo"></h3></a>
							</header>
							<p id="noticiabd3contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen4" class="image featured"><img src="images/pic04.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd4titulo"></h3>
							</header>
							<p id="noticiabd4contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen5" class="image featured"><img src="images/pic05.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd5titulo"></h3>
							</header>
							<p id="noticiabd5contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen6" class="image featured"><img src="images/pic01.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd6titulo"></h3>
							</header>
							<p id="noticiabd6contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen7" class="image featured"><img src="images/pic02.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd7titulo"></h3>
							</header>
							<p id="noticiabd7contenido"></p>
						</article>

						<article>
							<a href="#" id="imagen8" class="image featured"><img src="images/pic03.jpg" alt="" /></a>
							<header>
								<h3 id="noticiabd8titulo"></h3>
							</header>
							<p id="noticiabd8contenido"></p>
						</article>


					</div>

				</section>


				</div>

			<!-- Features -->
				<div class="wrapper style1">

					<section id="features" class="container special">
						<header>
							<h2>Chat</h2>
							<p>Habla con tus colegas acerca de una noticia!! :)</p>
						
						</header>
						<div class="hola">
							<input id="username" type="text" style="width:50%" size="80%" placeholder="Nombre de Usuario" > <br>
							<textarea id="contenidochat" style="width:85% ; height: 320px" placeholder="Chat" disabled="true"></textarea><br>
							<input id="mensajechat" type="text" style="width:50%" size="80%" placeholder="Mensaje" >
							<input id="submitchat" type="submit" style="height:20%; width:20%" value="Enviar" onClick="enviarChat()"><br><br>
					        
							
						</div>
					</section>

				</div>

				<div class="wrapper style1">

					<section id="features3" class="container special">
						<header>
							<h2>Detalle Noticia</h2>
							<h3>Titulo</h3>
							<p id="titulodetalle"></p>
							<h3>Contenido</h3>
							<p id="contenidodetalle"></p>
							<h3>Fecha</h3>
							<p id="fechadetalle"></p>

						
						</header>
						
					</section>

				</div>

			<!-- Footer -->
				<div id="footer">
					<div class="container">
						<div class="row">

							

						

							

						</div>
						<hr />
						<div class="row">
							<div class="12u">

								<!-- Copyright -->
									<div class="copyright">
										<ul class="menu">
											<li>&copy; Appmope. Todos los derechos reservados.</li>
										</ul>
									</div>

							</div>

						</div>
					</div>
				</div>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.onvisible.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
			<script src="http://www.hivemq.com/demos/websocket-client/js/mqttws31.js" type="text/javascript"></script>
<!-- Script para conectarnos al broker-->	
<script type="text/javascript">
        
 var client = new Messaging.Client("test.mosquitto.org", 8080, "myclientid_" + parseInt(Math.random() * 100, 10));
 var clientchat = new Messaging.Client("test.mosquitto.org", 8080, "myclientidd_" + parseInt(Math.random() * 100, 10));
 


 var options = {
     timeout: 3,
     
     onSuccess: function () {
       
          $('#estado').text('Conectado');
         client.subscribe('/hackaton/noticia', {qos: 2});

     },
    
     onFailure: function (message) {
        $('#estado').text('Error de conexion:');
       // client.connect(options);
       
     }
 };

 var options2 = {
     timeout: 3,
     
     onSuccess: function () {
       
         // $('#estado2').text('Conectado');
         clientchat.subscribe('/hackaton/chat', {qos: 2});

     },
    
     onFailure: function (message) {
     	// clientchat.connect(options2);
       // $('#estado2').text('Error de conexion:');
       
     }
 };

 client.connect(options);
 clientchat.connect(options2);

 //clientgrabadora.connect(options3);

function erase(){
    $('#messages').empty();

}
 client.onConnectionLost = function (responseObject) {
     //Depending on your scenario you could implement a reconnect logic here
      $('#messages').empty();
      $('#estado').text('Desconectado');
     //alert("connection lost: " + responseObject.errorMessage);

 };
 clientchat.onConnectionLost = function (responseObject) {
     //Depending on your scenario you could implement a reconnect logic here
    //clientchat.connect(options2);

 };

 //Gets called whenever you receive a message for your subscriptions
 client.onMessageArrived = function (message) {
     //Do something with the push message you received
    // $('#noticiamensaje').append('<span>Topic: ' + message.destinationName + '  | ' + message.payloadString + '</span><br/>');
     listadoNoticia();
    
 };
 clientchat.onMessageArrived = function (message) {
     //Do something with the push message you received
    // alert("Mensaje entrante");
    var hola = message.payloadString;
    var res = hola.split(",");
    if(res[0] == ""){
    	res[0]="Anonimo";
    }
      $('#contenidochat').val($('#contenidochat').val()+''+res[0]+': '+res[1]+'\n'); 
     //$('#contenidochat').append('<span>Topic: ' + message.destinationName + '  | ' + message.payloadString + '</span><br/>');
    
 };
 
 </script>

<!-- Script para enviar de phonegap a mqtt -->

 <script type="text/javascript">

var latitud = "";
var longitud = "";
    function onBodyLoad(){
    document.addEventListener("deviceready", onDeviceReady, false);
    
}
function onDeviceReady(){
    //alert("hola");
    $("#phonegap").html("PhoneGap en marcha, funciona!!!");
   var watchID = navigator.geolocation.watchPosition(onSuccess, onError, { timeout: 30000 });
}
function onSuccess(position) {
    latitud = position.coords.latitude;
    longitud = position.coords.longitude;
    $("#geo").html("");
    $("#geo").append('Latitude: '          + position.coords.latitude          + '\n' +
          'Longitude: '         + position.coords.longitude         + '\n' +
          'Altitude: '          + position.coords.altitude          + '\n' +
          'Accuracy: '          + position.coords.accuracy          + '\n' +
          'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
          'Heading: '           + position.coords.heading           + '\n' +
          'Speed: '             + position.coords.speed             + '\n' +
          'Timestamp: '         + position.timestamp                + '\n');
    var message = new Messaging.Message(''+position.coords.latitude +','+position.coords.longitude  +'');
     message.destinationName = '/hackaton/geo';
     message.qos = 2;
     client.send(message);
    //publish(''acceleration.x'','/world',2);
}
function onError() {
    $("#phonegap").html("No entro");
    //alert('onError!');
}
var options = { frequency: 3000 };  // Update every 3 seconds
if (navigator.geolocation){
	navigator.geolocation.getCurrentPosition(function(objPosition)
		{
			longitud = objPosition.coords.longitude;
			latitud = objPosition.coords.latitude;

			//content.innerHTML = "<p><strong>Latitud:</strong> " + lat + "</p><p><strong>Longitud:</strong> " + lon + "</p>";

		});
}


function enviarNoticia(){

		
	var f = new Date();
	var cad = ""+f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()+" "+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+"";
	//alert(cad);
	var titulo = $("#titulo").val();
	var noticia = $("#contenidoNoticia").val();
	var lati = latitud;
	var longi = longitud;
	var message = new Messaging.Message(''+titulo+','+noticia+','+lati+','+longi+'');
	//alert(titulo);
     message.destinationName = '/hackaton/noticia';
     message.qos = 2;
     client.send(message);
         jQuery.ajax({
         type: "POST",
         url: "http://nodejs-sisinfo.rhcloud.com/noticia",
         contentType: 'application/x-www-form-urlencoded',
         dataType: "json",
         data : {"titulo": ""+titulo+"","contenido":""+noticia+"","latitud":""+lati+"","longitud":""+longi+"", "nombre":"","fecha":""+cad+""},
         async: true,
         success: function (data, textStatus) {
          
             console.log("Logramos insertar la noticia en la bd");
             
         },
         error: function (textStatus, errorThrown) {
           
            console.log("No logramos insertar la noticia en la bd");
         }
    });
     alert("Noticia Publicada");
     $("#titulo").val("");
	 $("#contenidoNoticia").val("");

}
function enviarChat(){

	var f = new Date();
	var cad = ""+f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()+" "+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+"";
	var username = $("#username").val();
	var mensaje = $("#mensajechat").val();
	var message = new Messaging.Message(''+username+','+mensaje+'');
	//alert(titulo);
     message.destinationName = '/hackaton/chat';
     message.qos = 2;
     client.send(message);
     jQuery.ajax({
         type: "POST",
         url: "http://nodejs-sisinfo.rhcloud.com/insertarchat",
         contentType: 'application/x-www-form-urlencoded',
         dataType: "json",
         data : {"username": ""+username+"","mensaje":""+mensaje+"","fecha":""+cad+""},
         async: true,
         success: function (data, textStatus) {
          
             console.log("Logramos insertar la noticia en la bd");
             
         },
         error: function (textStatus, errorThrown) {
           
            console.log("No logramos insertar la noticia en la bd");
         }
    });
     //alert("Noticia Publicada");
    $("#mensajechat").val("");

}
function listadoNoticia () {

        jQuery.ajax({
         type: "GET",
         url: "http://nodejs-sisinfo.rhcloud.com/listadonoticia",
         contentType: "application/json; charset=utf-8",
         dataType: "json",
         async: true,
         success: function (data, textStatus) {
            
             console.log("Lo logramos");
             //alert(data[0].titulo);
             var como = parseInt(data[0]._id);
             $("#noticiabd1titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[0].titulo + "\")'>"+data[0].titulo+" </a>");
            // $("#noticiabd1contenido").html(data[0]['contenido']);
             //$("#noticiabd1contenido").append(data[0]['latitud']);
             //$("#noticiabd1contenido").append(data[0]['longitud']);
             //$("#noticiabd1contenido").append(data[0]['nombre']);
             //$("#noticiabd1contenido").append(data[0]['fecha']);
             $('#imagen1').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[0]['latitud']+','+data[0]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[0]['latitud']+','+data[0]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');

              $("#noticiabd2titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[1].titulo + "\")'>"+data[1].titulo+" </a>");
             // $("#noticiabd2contenido").html(data[1]['contenido']);
             // $("#noticiabd2contenido").append(data[1]['latitud']);
             // $("#noticiabd2contenido").append(data[1]['longitud']);
             // $("#noticiabd2contenido").append(data[1]['nombre']);
             // $("#noticiabd2contenido").append(data[1]['fecha']);
              $('#imagen2').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[1]['latitud']+','+data[1]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[1]['latitud']+','+data[1]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');
				
			 $("#noticiabd3titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[2].titulo + "\")'>"+data[2].titulo+" </a>");
             // $("#noticiabd3contenido").html(data[2]['contenido']);
             // $("#noticiabd3contenido").append(data[2]['latitud']);
             // $("#noticiabd3contenido").append(data[2]['longitud']);
             // $("#noticiabd3contenido").append(data[2]['nombre']);
             // $("#noticiabd3contenido").append(data[2]['fecha']);
             $('#imagen3').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[2]['latitud']+','+data[2]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[2]['latitud']+','+data[2]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');

             $("#noticiabd4titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[3].titulo + "\")'>"+data[3].titulo+" </a>");
             // $("#noticiabd4contenido").html(data[3]['contenido']);
             // $("#noticiabd4contenido").append(data[3]['latitud']);
             // $("#noticiabd4contenido").append(data[3]['longitud']);
             // $("#noticiabd4contenido").append(data[3]['nombre']);
             // $("#noticiabd4contenido").append(data[3]['fecha']);
             $('#imagen4').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[3]['latitud']+','+data[3]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[3]['latitud']+','+data[3]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');
			
			 $("#noticiabd5titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[4].titulo + "\")'>"+data[4].titulo+" </a>");
             // $("#noticiabd5contenido").html(data[4]['contenido']);
             // $("#noticiabd5contenido").append(data[4]['latitud']);
             // $("#noticiabd5contenido").append(data[4]['longitud']);
             // $("#noticiabd5contenido").append(data[4]['nombre']);
             // $("#noticiabd5contenido").append(data[4]['fecha']);
             $('#imagen5').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[4]['latitud']+','+data[4]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[4]['latitud']+','+data[4]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');

              $("#noticiabd6titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[5].titulo + "\")'>"+data[5].titulo+" </a>");
             // $("#noticiabd6contenido").html(data[5]['contenido']);
             // $("#noticiabd6contenido").append(data[5]['latitud']);
             // $("#noticiabd6contenido").append(data[5]['longitud']);
             // $("#noticiabd6contenido").append(data[5]['nombre']);
             // $("#noticiabd6contenido").append(data[5]['fecha']);
             $('#imagen6').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[5]['latitud']+','+data[5]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[5]['latitud']+','+data[5]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');

              $("#noticiabd7titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[6].titulo + "\")'>"+data[6].titulo+" </a>");
             // $("#noticiabd7contenido").html(data[6]['contenido']);
             // $("#noticiabd7contenido").append(data[6]['latitud']);
             // $("#noticiabd7contenido").append(data[6]['longitud']);
             // $("#noticiabd7contenido").append(data[6]['nombre']);
             // $("#noticiabd7contenido").append(data[6]['fecha']);
             $('#imagen7').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[6]['latitud']+','+data[6]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[6]['latitud']+','+data[6]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');

              $("#noticiabd8titulo").html("<a href='#features3' onClick='detalleNoticias(\"" + data[7].titulo + "\")'>"+data[7].titulo+" </a>");
             // $("#noticiabd5contenido").html(data[7]['contenido']);
             // $("#noticiabd5contenido").append(data[7]['latitud']);
             // $("#noticiabd5contenido").append(data[7]['longitud']);
             // $("#noticiabd5contenido").append(data[7]['nombre']);
             // $("#noticiabd5contenido").append(data[7]['fecha']);
             $('#imagen8').html('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+data[7]['latitud']+','+data[7]['longitud']+'&markers=color:blue%7Clabel:S%7C4'+data[7]['latitud']+','+data[7]['longitud']+'&zoom=15&size=336x234&maptype=roadmap&key=AIzaSyDVdAh_OHEU-a2CoCSfyXaandQQCLZdL4w">');
          
         },

         error: function (textStatus, errorThrown) {
           // alert("No exito");
            console.log("No lo logramos :(");
                //document.write(noExito);
         }
    });
    }
    listadoNoticia();

    function buscarClave(){
    	var clave1 = $("#palabraclave1").val();
    	var clave2 = $("#palabraclave2").val();
    	var clave3 = $("#palabraclave3").val();
    	 jQuery.ajax({
         type: "POST",
         url: "http://nodejs-sisinfo.rhcloud.com/buscarnoticia",
         contentType: 'application/x-www-form-urlencoded',
         dataType: "text",
         data : {"clave1":""+clave1+"","clave2":""+clave2+"","clave3":""+clave3+""},
         async: true,
         success: function (data, textStatus) {
          
             alert(data);
             
         },
         error: function (textStatus, errorThrown) {
           
            console.log("No relizo la peticion correctamente");
         }
    });
    	//alert(""+clave1+", "+clave2+", "+clave3+"");


    }
     function detalleNoticias(hola){
    	
    	 jQuery.ajax({
         type: "POST",
         url: "http://nodejs-sisinfo.rhcloud.com/buscarid",
         contentType: 'application/x-www-form-urlencoded',
         dataType: "json",
         data : {"id":""+hola+""},
         async: true,
         success: function (data, textStatus) {
          
              //alert(data[0].titulo);
              $("#titulodetalle").html(data[0]['titulo']);
              $("#contenidodetalle").html(data[0]['contenido']);
               $("#fechadetalle").html(data[0]['fecha']);

             
         },
         error: function (textStatus, errorThrown) {
           
            console.log("No relizo la peticion correctamente detalle");
         }
    });
    	//alert(""+clave1+", "+clave2+", "+clave3+"");


    };


</script>
</body>
</html>